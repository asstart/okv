---

title: 05. Procurement
layout: default
parent: Data warehouse toolkit
grand_parent: Books log

---

## Modeling Procurement

Procurement involves a wide range of activities from negotiating contracts to issuing purchase requisitions and purchase orders (POs) to tracking receipts and authorizing payments.

Procurement common analytic requirements:

1.  Which materials or products are most frequently purchased? How many vendors supply these products? At what prices? Looking at demand across the enterprise (rather than at a single physical location), are there opportunities to negotiate favorable pricing by consolidating suppliers, single sourcing, or making guaranteed buys?
2.  Are your employees purchasing from the preferred vendors or skirting the negotiated vendor agreements with maverick spending?
3.  Are you receiving the negotiated pricing from your vendors, or is there vendor contract purchase price variance?
4.  How are your vendors performing? What is the vendorâ€™s fill rate? On-time delivery performance? Late deliveries outstanding? Percent back ordered? Rejection rate based on receipt inspection?

There are 2 types of fact tables can be useful here: transactions and accumulating snapshot

![Procurement.jpg](/Books%20log/Data%20warehouse%20toolkit/img/Procurement.jpg)

## Single vs Multiple Transaction Fact Tables

As dimensional modeler you may appear in situation when you need to choose either create fact table that will contain all transactions with Transaction Type Dimension or create separate fact table for each type of transactions.

To make a decision in this case, you need better understand business processes and how this data is supposed to be used. Following question may help to make a right decision:

1.  How will the business users most commonly analyze this data? - Because our main goal is to provide data in simplest way to analyze
2.  Are there really multiple unique business processes? - If it's really different business processes and data comes from different source, this may lead to a separate fact tables
3.  Are multiple source systems capturing metrics with unique granularities? - If different BP have different granularities, this may lead to a separate fact tables
4.  What is the dimensionality of the facts? - If there are some disjoint dimensions between different transactions, this may lead to a separate fact tables

## Slowly Changing Dimension (SCD)

### Type 0: Retain Original

With type 0, the dimension attribute value never changes, so facts are always grouped by this original value. As was discussed before, dimension tables should have *surrogate key* as a *primary key* of the table instead of *natural key*. So if we create *supernatural durable key* it will have SCD Type 0, because it must remain *original*. Also, this type can apply to almost all attribute in Date Dimension.

### Type 1: Overwrite

Old attribute in a dimension table overwrites with a new value. An attribute, in this case, always reflects the most recent assignment.
When using this type - fact table remains untouched.
The history of attribute changing lost.

### Type 2: Add New Row

If any row in dimension table changed - new row will be added.

When using this type - fact table also remains untouched. Facts added before this change reference to an old row, facts added after this change reference to a new row. So, unlike Type 1, reports and cubes won't be affected.

Type 2 allow saving history of attribute changes and *natural key* can be used to overview this history. To be able to navigate through history properly, additional attributes should be used: *Effective Date* and *Expiration Date*. They designate in which period row were actual.

It's not uncommon to mix SCD techniques inside one dimension. Some attribute may have Type 1 when others are Type 2.

### Type 3: Add New Attribute

If any row in dimension table changed - this table will be altered and new attribute will be added. This isn't a recommend approach to handle unpredictable changes of attribute, but it can be useful if some kind of big changes happened in company and all rows should be altered without losing current information. Also, it might be useful as additional attribute which hold previous value of an attribute.

### Type 4: Mini-Dimension

If dimension tables change fast, especially if one or small number of attributes are cause of this frequent changes - SDC Type 2 may become a problem with negative impact on browsing and query performance. To fix this, problem attribute can be separated to personal *mini-dimension* table and fact table will hold 2 FK instead of 1.

This mini-dimension table is supposed to be Type 1 to avoid explosive growth.

> Need more examples, this isn't really clear((

### Type 5: Mini-Dimension and Type 1 Outrigger

The same mini-dimension as in Type 4, but unlike Type 4, the main dimension table holds a link to this mini-dimension instead of Fact table.

The type 5 technique is useful if you want to browse dimension table in the absence of fact table metrics.

### Type 6: Add Type 1 Attributes to Type 2 Dimension

In fact, it's a combination of Type 1, Type 2 and Type 3. There are 3 main parts of this approach:

1.  According to Type 2, new row will be added with new attribute value if it changes
2.  According to Type 3, when new row added, value of this attribute from the previous version added to the same attribute with prefix "historic". (We always have 2 version of attribute: current and historic (previous), table won't grow beyond these 2 attributes)
3.  According to Type 1 - we need to override an attribute value. In all rows, the value of attribute with prefix "current" changes to the newest value, while value of attribute with prefix "historic" remains untouched.

Example of evolution dimension table in case using Type 6 (look at Historic Department Name and Current Department Name):

![Pasted image 20230215182024.png](/Books%20log/Data%20warehouse%20toolkit/img/Pasted%20image%2020230215182024.png)

### Type 7: Dual Type 1 and Type 2 Dimensions

This approach serves the same goal as Type 6: preserve current and historic perspective for certain attribute, but might be applied if the number of these attributes is large.

This technique requires *durable natural key*.

Fact table contains 2 FK for the same dimension: *surrogate key* that used as a common FK in dimension modeling and *natural key*.
*Surrogate key* FK joins to a standard Type 2 dimension, which represents historically accurate attributes for filtering and grouping.
*Natural key* FK joins to a Type 1 dimension, which contains only current values of the attribute (it is not necessarily a new table, it can be just a view over dimension table).
![Pasted image 20230215184332.png](/Books%20log/Data%20warehouse%20toolkit/img/Pasted%20image%2020230215184332.png)

### Summary

![Pasted image 20230215184512.png](/Books%20log/Data%20warehouse%20toolkit/img/Pasted%20image%2020230215184512.png)
